# GARAMe Manager 라이선스 키 시스템 설계

## 개요

제품의 불법 복사 및 실행을 방지하기 위한 정품 등록키 시스템입니다.

## 라이선스 키 종류

### 1. 테스트 키 (TRIAL)
- **유효 기간**: 7일
- **기능 제한**: 없음 (전체 기능 사용 가능)
- **용도**: 제품 평가/테스트
- **식별자**: `TRIAL-XXXX-XXXX-XXXX`

### 2. 기간 제한 키 (TIMED)
- **유효 기간**: 지정된 기간 (30일, 90일, 1년 등)
- **기능 제한**: 없음
- **용도**: 기간 기반 구독
- **식별자**: `TIMED-XXXX-XXXX-XXXX`

### 3. 영구 키 (PERPETUAL)
- **유효 기간**: 무제한
- **기능 제한**: 없음
- **용도**: 영구 라이선스 구매
- **식별자**: `PERPT-XXXX-XXXX-XXXX`

### 4. 버전 제한 키 (VERSION)
- **유효 기간**: 무제한
- **기능 제한**: 특정 버전까지만 업그레이드 가능
- **용도**: 버전별 라이선스 판매
- **식별자**: `VERSN-XXXX-XXXX-XXXX`

## 키 구조

```
TYPE-AAAA-BBBB-CCCC-DDDD-EEEE
│    │    │    │    │    │
│    │    │    │    │    └─ 체크섬 (CRC16)
│    │    │    │    └─────── 고객 ID (암호화)
│    │    │    └──────────── 유효기간/버전 (암호화)
│    │    └───────────────── 발급일 (암호화)
│    └────────────────────── 랜덤 Salt
└─────────────────────────── 라이선스 타입
```

## 보안 기능

### 1. 하드웨어 바인딩
- MAC 주소 해시
- CPU ID (가능한 경우)
- 머신 UUID

### 2. 변조 방지
- 키 파일 암호화 (AES-256)
- 무결성 검증 (HMAC-SHA256)
- 바이너리 난독화

### 3. 서버 인증 (선택적)
- 온라인 활성화 지원
- 오프라인 활성화 지원 (하드웨어 바인딩)

## 파일 구조

```
/home/garam/바탕화면/code/1.9.8.4/
├── src/tcp_monitor/
│   └── license/
│       ├── __init__.py
│       ├── key_validator.py    # 키 검증 로직
│       ├── hardware_id.py      # 하드웨어 ID 생성
│       └── license_manager.py  # 라이선스 관리
│
└── tools/
    └── license_generator/
        ├── generator.py        # 키 생성 도구 (관리자용)
        ├── gui.py              # GUI 인터페이스
        └── config.py           # 비밀키 설정
```

## 키 생성기 (관리자용)

### 기능
1. 테스트 키 생성 (7일)
2. 기간 제한 키 생성 (사용자 지정)
3. 영구 키 생성
4. 버전 제한 키 생성
5. 대량 키 생성 (CSV 내보내기)
6. 키 내역 관리

### UI
```
┌─────────────────────────────────────────────┐
│       GARAMe Manager 라이선스 키 생성기      │
├─────────────────────────────────────────────┤
│ 라이선스 타입:                               │
│ ○ 테스트 (7일)                              │
│ ○ 기간 제한                                 │
│   └─ 유효기간: [30  ] 일                    │
│ ○ 영구                                      │
│ ○ 버전 제한                                 │
│   └─ 최대 버전: [1.9.8.4]                  │
├─────────────────────────────────────────────┤
│ 고객 정보:                                   │
│ 회사명: [________________]                  │
│ 담당자: [________________]                  │
│ 이메일: [________________]                  │
│ 비고:   [________________]                  │
├─────────────────────────────────────────────┤
│ 생성 수량: [1   ]                           │
│                                             │
│      [키 생성]  [CSV 내보내기]  [종료]       │
├─────────────────────────────────────────────┤
│ 생성된 키:                                   │
│ TRIAL-A1B2-C3D4-E5F6-G7H8-I9J0             │
│                                             │
│ [클립보드 복사]                             │
└─────────────────────────────────────────────┘
```

## 제품 활성화 (사용자)

### 최초 실행 시
1. 라이선스 키 입력 창 표시
2. 키 형식 검증
3. 키 복호화 및 검증
4. 하드웨어 바인딩 생성
5. 라이선스 파일 저장 (암호화)

### 이후 실행 시
1. 라이선스 파일 로드
2. 무결성 검증
3. 하드웨어 ID 비교
4. 유효기간/버전 확인
5. 정상 → 프로그램 실행
6. 만료/오류 → 키 재입력 요청

## 활성화 UI
```
┌─────────────────────────────────────────────┐
│           GARAMe Manager 정품 인증           │
├─────────────────────────────────────────────┤
│                                             │
│  라이선스 키를 입력해 주세요:                │
│  ┌─────────────────────────────────────┐   │
│  │ TRIAL-____-____-____-____-____      │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [인증하기]              [나중에]           │
│                                             │
│  ─────────────────────────────────────────  │
│  ℹ 테스트 키는 7일간 무료로 사용할 수      │
│    있습니다.                                │
│  ℹ 정품 구매: https://garame.co.kr         │
│                                             │
└─────────────────────────────────────────────┘
```

## 만료 시 동작

### 테스트 키 만료
- 프로그램 실행 가능
- 기능 제한: 저장 비활성화
- 만료 경고 메시지 표시

### 기간 제한 키 만료
- 프로그램 실행 가능
- 기능 제한: 저장 비활성화
- 갱신 안내 표시

### 버전 제한 키
- 허용된 버전까지만 실행
- 신규 버전 업그레이드 시 키 갱신 필요

## 구현 우선순위

1. **Phase 1**: 기본 키 검증 시스템
   - 키 형식 검증
   - 단순 암호화/복호화
   - 유효기간 확인

2. **Phase 2**: 하드웨어 바인딩
   - 머신 ID 생성
   - 라이선스 파일 암호화

3. **Phase 3**: 키 생성기 GUI
   - 관리자용 키 생성 도구
   - 키 관리 기능

4. **Phase 4**: 고급 기능
   - 온라인 활성화 (선택)
   - 버전 제한
   - 키 비활성화

## 보안 주의사항

1. **비밀키 보호**: 키 생성에 사용되는 비밀키는 소스코드에 포함하지 않음
2. **난독화**: PyInstaller 빌드 시 코드 난독화 적용
3. **체크섬**: 실행 파일 무결성 검증
4. **로깅**: 비정상 활성화 시도 로깅

## 관련 파일

- `src/tcp_monitor/license/` - 라이선스 검증 모듈
- `tools/license_generator/` - 키 생성 도구
- `~/.garame/license.dat` - 라이선스 파일 (암호화됨)
