# GARAMe 매니저 프로그램 메인 화면 구조도

## 전체 구조 개요

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          GARAMe 매니저 메인 화면                               │
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                        탭 네비게이션 (상단)                              │  │
│  │  [센서1 탭] [센서2 탭] [센서3 탭] [센서4 탭] [접속 대기 탭]             │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                     센서 패널 (SensorPanel)                             │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │                  패널 헤더 (PanelHeader)                         │  │  │
│  │  │                                                                   │  │  │
│  │  │  [로고] [센서ID] [📸 캡쳐] [시계] [🔊] [거울보기] [관리자]       │  │  │
│  │  │                                                                   │  │  │
│  │  │      [체감온도 HI: 25.3°C]  [불쾌지수 DI: 68.2]                  │  │  │
│  │  │                                                                   │  │  │
│  │  │  [문구-][문구+][타일-][타일+][그래프][도면][전체화면][종료]      │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │               안내 문구 (msg_label)                              │  │  │
│  │  │  "현장 작업자 여러분, 안전한 작업을 위해 센서를 확인하세요"       │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │              3x3 타일 그리드 (PanelTiles)                        │  │  │
│  │  │                                                                   │  │  │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐                      │  │  │
│  │  │  │  CO2     │  │   O2     │  │  H2S     │                      │  │  │
│  │  │  │  450 ppm │  │  20.9 %  │  │  2 ppm   │                      │  │  │
│  │  │  └──────────┘  └──────────┘  └──────────┘                      │  │  │
│  │  │                                                                   │  │  │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐                      │  │  │
│  │  │  │  CO      │  │  LEL     │  │  연기    │                      │  │  │
│  │  │  │  5 ppm   │  │  0 %     │  │  0 %     │                      │  │  │
│  │  │  └──────────┘  └──────────┘  └──────────┘                      │  │  │
│  │  │                                                                   │  │  │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐                      │  │  │
│  │  │  │  온도    │  │  습도    │  │ 누수+날씨 │                      │  │  │
│  │  │  │  25.3 °C │  │  65 %    │  │ 정상/맑음 │                      │  │  │
│  │  │  └──────────┘  └──────────┘  └──────────┘                      │  │  │
│  │  │                                                                   │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 1. 패널 헤더 (PanelHeader)

### 좌측 영역
```
┌──────────────────────────────────────────────────────────────┐
│ [로고] [센서ID] [📸 캡쳐] [시계] [🔊] [거울보기] [🔓 관리자] │
└──────────────────────────────────────────────────────────────┘
```

#### 구성 요소
1. **로고** - GARAMe 로고 이미지
2. **센서 ID** - 센서 식별자 (예: "센서1", "Sensor_A")
3. **📸 캡쳐 버튼** - 현재 화면 캡쳐
4. **시계** - 현재 시간 표시 (예: "2025-11-05 14:30:25")
5. **🔊 음성 토글** - 음성 경보 ON/OFF (🔊/🔇)
6. **거울보기 버튼** - 카메라 거울 모드 ON/OFF
7. **🔓 관리자 모드** - 관리자 모드 활성화 시 표시

### 중앙 영역
```
┌──────────────────────────────────────────────┐
│  [체감온도 HI: 25.3°C]  [불쾌지수 DI: 68.2]  │
└──────────────────────────────────────────────┘
```

- **체감온도 (Heat Index)** - 온도와 습도로 계산
- **불쾌지수 (Discomfort Index)** - 체감 쾌적도

### 우측 컨트롤 영역
```
┌────────────────────────────────────────────────────────┐
│ [문구-][문구+][타일-][타일+][그래프][도면][전체화면][종료] │
└────────────────────────────────────────────────────────┘
```

#### 버튼 설명
1. **문구-/문구+** - 안내 문구 폰트 크기 조절
2. **타일-/타일+** - 타일 크기 조절
3. **그래프** - 그래프 뷰 전환
4. **도면** - 도면 뷰 전환
5. **전체화면** - 전체화면 모드
6. **종료** - 프로그램 종료

## 2. 안내 문구 (msg_label)

```
┌─────────────────────────────────────────────────────────┐
│  현장 작업자 여러분, 안전한 작업을 위해 센서를 확인하세요  │
│  가스 농도가 기준치를 초과하면 즉시 대피하세요            │
└─────────────────────────────────────────────────────────┘
```

- 사용자 정의 안내 메시지
- 설정 파일(config.conf)에서 변경 가능

## 3. 센서 타일 그리드 (PanelTiles) - 3x3 배치

### 타일 배치
```
┌─────────────────────────────────────────────────────────────┐
│                     Row 0 (첫 번째 줄)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   CO2 타일   │  │   O2 타일    │  │  H2S 타일    │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
│                     Row 1 (두 번째 줄)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   CO 타일    │  │  LEL 타일    │  │  연기 타일   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
│                     Row 2 (세 번째 줄)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  온도 타일   │  │  습도 타일   │  │누수+날씨 타일│      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 개별 타일 구조

#### 일반 센서 타일 (예: CO2)
```
┌─────────────────────────────────────────────────┐
│  좌측 영역 (센서값)      │  우측 영역 (기준값)  │
│                          │                      │
│  ┌──────────────────┐   │  ┌──────────────┐   │
│  │     CO2          │   │  │ 5단계 경보    │   │
│  │                  │   │  │              │   │
│  │    450 ppm       │   │  │ 1단: 1000    │   │
│  │                  │   │  │ 2단: 1500    │   │
│  │ 통계: 400/450/500│   │  │ 3단: 2000    │   │
│  └──────────────────┘   │  │ 4단: 2500    │   │
│                          │  │ 5단: 3000    │   │
│                          │  └──────────────┘   │
└─────────────────────────────────────────────────┘
```

#### 누수+날씨 타일 (특수 타일)
```
┌─────────────────────────────────────────────────┐
│  좌측 영역              │  우측 영역 (날씨)      │
│                         │                       │
│  ┌──────────────────┐  │  ┌──────────────┐    │
│  │   누수           │  │  │   날씨 정보   │    │
│  │                  │  │  │              │    │
│  │   정상           │  │  │    맑음      │    │
│  │                  │  │  │   25.3°C     │    │
│  │ (누수 감지 없음) │  │  │   습도 65%   │    │
│  └──────────────────┘  │  │   풍속 2m/s  │    │
│                         │  └──────────────┘    │
└─────────────────────────────────────────────────┘
```

## 4. 센서 종류 및 순서 (SENSOR_KEYS)

### 9개 센서 타일
```python
SENSOR_KEYS = [
    "co2",         # 이산화탄소 (ppm)
    "o2",          # 산소 (%)
    "h2s",         # 황화수소 (ppm)
    "co",          # 일산화탄소 (ppm)
    "lel",         # 가연성 가스 (%)
    "smoke",       # 연기 (%)
    "temperature", # 온도 (°C)
    "humidity",    # 습도 (%)
    "water"        # 누수 + 날씨
]
```

### 그리드 위치 매핑
| 위치     | Row | Col | 센서       | 단위  |
|----------|-----|-----|------------|-------|
| (0, 0)   | 0   | 0   | CO2        | ppm   |
| (0, 1)   | 0   | 1   | O2         | %     |
| (0, 2)   | 0   | 2   | H2S        | ppm   |
| (1, 0)   | 1   | 0   | CO         | ppm   |
| (1, 1)   | 1   | 1   | LEL        | %     |
| (1, 2)   | 1   | 2   | 연기       | %     |
| (2, 0)   | 2   | 0   | 온도       | °C    |
| (2, 1)   | 2   | 1   | 습도       | %     |
| (2, 2)   | 2   | 2   | 누수+날씨  | -     |

## 5. 타일 상태 및 색상

### 연결 상태별 표시
```
┌──────────────────────────────────────────────────────┐
│  상태          │ 배경색     │ 표시 내용              │
├──────────────────────────────────────────────────────┤
│  waiting       │ 회색       │ "접속 대기 중..."      │
│  connected     │ 녹색/빨강  │ 센서 값 + 통계         │
│  disconnected  │ 회색       │ 마지막 값 + "통신끊김" │
└──────────────────────────────────────────────────────┘
```

### 경보 상태별 색상
```
┌────────────────────────────────────────┐
│  정상    │ 녹색 (#4CAF50)           │
│  1단 경보│ 노란색 (#FFEB3B)         │
│  2단 경보│ 주황색 (#FF9800)         │
│  3단 경보│ 빨강색 (#FF5722)         │
│  4단 경보│ 진한 빨강 (#F44336)      │
│  5단 경보│ 보라색 (#9C27B0)         │
└────────────────────────────────────────┘
```

## 6. 뷰 모드

### 3가지 뷰 모드
```
┌─────────────────────────────────────────────────────┐
│  1. card (타일 뷰)    - 3x3 타일 그리드            │
│  2. graph (그래프 뷰) - 시계열 그래프              │
│  3. blueprint (도면 뷰) - 현장 도면 + 센서 위치   │
└─────────────────────────────────────────────────────┘
```

### 타일 뷰 (card)
- 기본 화면
- 3x3 센서 타일 그리드 표시
- 실시간 센서 값, 통계, 경보 기준 표시

### 그래프 뷰 (graph)
```
┌─────────────────────────────────────────────────────┐
│  [선택: CO2 ▼]  [1시간] [4시간] [12시간] [24시간]  │
│                                                       │
│   CO2 농도 (ppm)                                     │
│   3000│                                   ┌─ 5단     │
│   2500│                              ┌────┼─ 4단     │
│   2000│                         ┌────┼────┼─ 3단     │
│   1500│                    ┌────┼────┼────┼─ 2단     │
│   1000│               ┌────┼────┼────┼────┼─ 1단     │
│    500│──┬────┬────┬──┴────┴────┴────┴────┴─ 정상   │
│      0│──┴────┴────┴───────────────────────────────  │
│        0h   6h   12h  18h  24h                        │
└─────────────────────────────────────────────────────┘
```

### 도면 뷰 (blueprint)
```
┌─────────────────────────────────────────────────────┐
│  [도면 선택 ▼]                                       │
│                                                       │
│          현장 도면 이미지                             │
│                                                       │
│     ┌──────────────────────────┐                    │
│     │                          │                    │
│     │   [센서1]   [센서2]      │                    │
│     │                          │                    │
│     │              [센서3]     │                    │
│     │                          │                    │
│     └──────────────────────────┘                    │
│                                                       │
│  각 센서 위치에 실시간 값 표시                        │
└─────────────────────────────────────────────────────┘
```

## 7. 특수 기능

### 거울보기 모드
```
┌─────────────────────────────────────────────────────┐
│  [좌우 반전 ☑]  [안전장구 감지 ☑]                   │
│                                                       │
│  ┌─────────────────────────────────────────────┐   │
│  │                                               │   │
│  │        카메라 화면 (좌우 반전)                │   │
│  │                                               │   │
│  │    ┌──────────┐                              │   │
│  │    │ 홍길동   │  ← 얼굴 인식 박스             │   │
│  │    └──────────┘                              │   │
│  │                                               │   │
│  │    안전모: ✓   보안경: ✓   장갑: ✓           │   │
│  │                                               │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### 상세 오버레이 (타일 클릭 시)
```
┌─────────────────────────────────────────────────────┐
│  [ ← 닫기 ]          CO2 상세 정보                   │
│                                                       │
│  현재 값: 450 ppm                                    │
│  상태: 정상                                           │
│                                                       │
│  오늘 통계:                                           │
│  - 최소: 400 ppm                                     │
│  - 평균: 450 ppm                                     │
│  - 최대: 500 ppm                                     │
│                                                       │
│  24시간 그래프:                                       │
│  [그래프 표시]                                        │
│                                                       │
│  경보 기록:                                           │
│  - 14:23:15 - 1단 경보 발생                         │
│  - 14:25:30 - 정상 복귀                             │
└─────────────────────────────────────────────────────┘
```

## 8. 파일 구조

### 주요 UI 컴포넌트 파일
```
src/tcp_monitor/ui/
├── app.py                    # 메인 애플리케이션
├── panel.py                  # 센서 패널 (SensorPanel)
├── panel_header.py           # 패널 헤더 (PanelHeader)
├── panel_tiles.py            # 타일 그리드 (PanelTiles)
├── panel_graph_view.py       # 그래프 뷰
├── panel_blueprint_view.py   # 도면 뷰
├── panel_overlay.py          # 상세 오버레이
├── environment_settings.py   # 환경설정 다이얼로그
└── ...
```

## 9. 데이터 흐름

```
센서 (라즈베리파이)
    │
    │ TCP/IP (포트 9000)
    │ JSON Lines 프로토콜
    ↓
TCP 서버 (TcpServer)
    │
    │ Queue
    ↓
메인 애플리케이션 (App)
    │
    │ on_data()
    ↓
센서 패널 (SensorPanel)
    │
    │ update_data()
    ↓
타일 그리드 (PanelTiles)
    │
    │ update_tile()
    ↓
화면 표시 (Tkinter)
```

## 10. 요약

### 메인 화면 계층 구조
```
App (메인 애플리케이션)
└── Notebook (탭 컨테이너)
    ├── SensorPanel (센서1 탭)
    │   ├── PanelHeader (헤더)
    │   ├── msg_label (안내 문구)
    │   └── PanelTiles (3x3 타일 그리드)
    │       ├── CO2 타일
    │       ├── O2 타일
    │       ├── H2S 타일
    │       ├── CO 타일
    │       ├── LEL 타일
    │       ├── 연기 타일
    │       ├── 온도 타일
    │       ├── 습도 타일
    │       └── 누수+날씨 타일
    ├── SensorPanel (센서2 탭)
    ├── SensorPanel (센서3 탭)
    ├── SensorPanel (센서4 탭)
    └── WaitingPanel (접속 대기 탭)
```

### 핵심 특징
1. **다중 센서 지원** - 최대 4개 센서 동시 모니터링
2. **실시간 데이터** - TCP 소켓으로 실시간 수신
3. **5단계 경보** - 센서별 5단계 경보 시스템
4. **다양한 뷰** - 타일/그래프/도면 뷰
5. **거울보기** - 안전장구 감지 기능
6. **날씨 연동** - 기상청 API 연동
7. **반응형 UI** - 화면 크기에 따라 자동 조절

---

**버전**: v1.9.0
**작성일**: 2025-11-05
**작성자**: Claude Code
